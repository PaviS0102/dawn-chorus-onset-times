---
editor_options: 
  chunk_output_type: console
---

# Eye size analyses 

In this script, we will compare the eye size estimates obtained using eBird photos with Ausprey & Stanley 2024's eye morphology dataset from preserved museum specimens.

## Install required libraries  

```{r}
library(tidyverse)
library(dplyr)
library(stringr)
library(vegan)
library(ggplot2)
library(scico)
library(data.table)
library(extrafont)
library(sf)
library(raster)
library(ggpubr)
```

## Loading the data

```{r}
species_traits <- read.csv ('data/species-trait-dat.csv') #to obtain the list of required species
eye_size_museum <- read.csv ('data/eye-size-museum.csv') #file with museum-derived eye size measurements
eye_size_ebird <- read.csv ('data/eye-size-ebird.csv') #file with eBird photo-derived eye size measurements
```

## Obtaining a list of species that are present in the eye size dataset- this is only for our reference

```{r}
species_there <- data.frame (scientific_name = intersect (species_traits$scientific_name, eye_size_museum$species_jetz))

sp_list_on_A_S <- inner_join (species_traits, species_there, by = 'scientific_name') 
```

## Cleaning the eye size data obtained from eBird photos

```{r}
eye_size_ebird <- eye_size_ebird %>%
  rename (scientific_name = Species) %>% #renaming for easier analyses
  dplyr::select (scientific_name, Eye_Size_in_mm_averaged, Error_of_bill_ratio) %>% #retaining only select columns
  filter (!(scientific_name == 'Hypsipetes ganeesa')) %>%
  group_by (scientific_name) %>%
  slice_min (order_by = abs(Error_of_bill_ratio), n = 10) %>% #only selecting those estimates which have the least error ratios of all estimates
  summarize (mean_eye_size = mean(Eye_Size_in_mm_averaged)) %>% #obtaining the mean eye size measurements for our species
  left_join (., species_traits, by = 'scientific_name') %>%
  dplyr::select (scientific_name, mean_eye_size, common_name, mass) %>% 
  mutate (rel_mean_eye_size = mean_eye_size/mass) %>% #calculating mean eye sizes relative to body mass for each species
  ungroup ()
```

## Filtering the required species and obtaining the optical axial diameter measurements for each species (From Ausprey and Stanley's dataset)

```{r}
eye_size_museum <- eye_size_museum %>%
  rename (scientific_name = species_jetz) %>% #renaming for easier analyses
  dplyr::select (scientific_name, AD) %>% #retaining only select columns
  filter (scientific_name %in% eye_size_ebird$scientific_name) %>% #filtering the required species
  group_by (scientific_name) %>%
  summarize (mean_AD = mean (AD)) %>% #obtaining the mean axial diameter measurements for our species
 left_join (., species_traits, by = 'scientific_name') %>%
  dplyr::select (scientific_name, mean_AD, common_name, mass) %>% 
  mutate (rel_mean_AD = mean_AD/mass) %>% #calculating mean eye sizes relative to body mass for each species
  ungroup ()
```

## Correlation between eye size estimates obtained from ebird and Ausprey & Stanley

```{r}
eye_size_estimates <- left_join (eye_size_ebird, eye_size_museum, by = 'scientific_name') #combining both the data

cor_plot <- ggscatter(eye_size_estimates, x = 'rel_mean_AD', y = 'rel_mean_eye_size', 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "spearman", cor.coef.size = 6, 
          cor.coef.args = list (label.x.npc = "left", label.y.npc = "top"),
          xlab = "Relative eye size estimates using Ausprey & Stanley 2024", ylab = "Relative eye size estimates using eBird", 
          col = 'black', shape = 20, size = 5,
          label = 'scientific_name' , font.label = c(15, "black"), font.family = "Century Gothic", repel = TRUE) +
  theme(text = element_text (family = "Century Gothic")),
  axis.text =  element_text(size = 20, family = "Century Gothic", colour = "black"),
  axis.title = element_text (size =20, family = "Century Gothic", colour = "black")) 

```


